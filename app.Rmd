---
title: "Today's Top Hits"
author: "Ankit Sanghi, Sarah Hussain"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(shiny)
all_data <- read_csv("./data.csv")
data_by_artist <- read_csv("./data_by_artist.csv")
data_by_year <- read_csv("./data_by_year.csv")
data_by_genres <- read_csv("./data_by_genres.csv")
data_w_genres <- read_csv("./data_w_genres.csv")
pivoted_data_by_year <- data_by_year %>%
        pivot_longer(cols = c("acousticness", 
                                 "danceability", 
                                 "energy", 
                                 "instrumentalness", 
                                 "valence", 
                                 "liveness", 
                                 "speechiness"),
                     names_to = "metric", 
                     values_to = "values")
```


## Motivation and Background

Spotify grants it's users access to over 60 million songs, ranging from over 3000 genres, 32000 artists, across 102 years. It also encodes certain metrics related to each song about the nature of the song such as danceability, acousticness, valency, and many more. This gives us the rare opportunity to see how these metrics change over time and whether there are relations between them. It also let's us analyze whether any given decade has a particular musical profile associated with it. How do musical profiles change across the decades? Does music overall get more popular over time? These are all questions that can be answered using our Spotify dataset, which is why we are conducting this analysis.

## Objectives

We wanted to answer four main questions. First, we wanted to see how song profiles change over the years. Does each decade have a distinct sound profile? Next, we wanted to look at how the popularity of music overall changes through the 20th and early 21st century. Does the popularity of music in general increase or decrease over time? Finally, given a song's profile, can we use statistical learning to predict how popular it would be and which decade it would fall in? These are all questions that could give us a lot of insight into how music has changed over the years and what kind of music remains popular across the ages.

## The Data

Our data was found on [Kaggle](https://www.kaggle.com/yamaerenay/spotify-dataset-19212020-160k-tracks). It was scraped by Yamac Eren Ay and contains 174389 songs with 19 variables. Each row is a song on Spotify and the columns include the following information:

Primary:

- id (Id of track generated by Spotify)

Numerical:

- acousticness (Ranges from 0 to 1)
- danceability (Ranges from 0 to 1)
- energy (Ranges from 0 to 1)
- duration_ms (Integer typically ranging from 200k to 300k)
- instrumentalness (Ranges from 0 to 1)
- valence (Ranges from 0 to 1)
- popularity (Ranges from 0 to 100)
- tempo (Float typically ranging from 50 to 150)
- liveness (Ranges from 0 to 1)
- loudness (Float typically ranging from -60 to 0)
- speechiness (Ranges from 0 to 1)
- year (Ranges from 1921 to 2020)

Dummy:

- mode (0 = Minor, 1 = Major)
- explicit (0 = No explicit content, 1 = Explicit content)

Categorical:

- key (All keys on octave encoded as values ranging from 0 to 11, starting on C as 0, C# as 1 and so onâ€¦)
- artists (List of artists mentioned)
- release_date (Date of release mostly in yyyy-mm-dd format, however precision of date may vary)
- name (Name of the song)

This information can also be found on the Kaggle page for the data. Overall, the dataset is very robust and fully featured, and can provide some very valuable insights into how music has evolved over the years.

## Analysis

### Song Profiles over Time

First, let us look at the different song profiles over time. Below is a graph where you can toggle various metrics and compare them. We will be going over the notable cases in these metrics. 

```{r, echo=FALSE}
sidebarLayout(
    sidebarPanel(
      checkboxGroupInput("metrics", "Song Profile Metrics", 
                     choices = c("acousticness", 
                                 "danceability", 
                                 "energy", 
                                 "instrumentalness", 
                                 "valence", 
                                 "speechiness"),
                     selected = c("acousticness", "energy")),
      width = 3
    ),
    mainPanel(
      renderPlot({
        pivoted_data_by_year %>%
        filter(metric %in% input$metrics) %>%
        ggplot(aes(x = year, y = values, color = metric)) + geom_line()
      })
    )
  )
```

First, we will compare acousticness and energy. We see that over time, the acousticness of music decreases and energy increases. We see energy overtake acousticness in the 1960s, which makes sense as this was when instruments like the electric guitar started becoming more popular. More rock and pop artists became popular during this period such as The Beatles, The Rolling Stones, The Beach Boys, Janis Joplin, and many others. These genres of music tend to use more synthesized sounds which explains the drop in acousticness and rise in energy.

```{r, echo=FALSE, fig.align="center"}
pivoted_data_by_year %>%
        filter(metric %in% c("acousticness", "energy")) %>%
        ggplot(aes(x = year, y = values, color = metric)) + geom_line()
```

Next, let us look at the change in danceability and valence over time. Valence is how positive or negative a song sounds. A low valence means the song sounds more negative and a high valence means it sounds more positive. If we look at the trend of valence and danceability, they are almost identical until the 2010s, where they start to diverge. It makes sense for them to be near identical as often music that is considered danceable is also positive sounding. It is pretty rare if music is negative and also danceable. So why do these two metrics diverge in the 2010s? If we also look at the energy metric, we see that also increase along with danceability. So this means that music is getting more energetic and danceable, but more negative sounding. This can be explained by the rise of rap music. Rap music often has a low beat that usually isn't categorized as sounding positive. The music used is often not cheerful or upbeat. Rather, it is heavy and serves as simply a background to the vocals. The rhythmic nature of rap makes it danceable and energetic, whereas the low sounds of the music gives it a low valence. Rap started picking up in the 2010s, where it beat rock and pop as the most popular genre of music. Thus, this could explain this divide between valence and danceability in the 2010s.

```{r, echo=FALSE, fig.align="center"}
pivoted_data_by_year %>%
        filter(metric %in% c("danceability", "valence")) %>%
        ggplot(aes(x = year, y = values, color = metric)) + geom_line()
```

Finally, let us look at instrumentalness and speechiness. Instrumentalness measures how instrumental a song is, and speechiness measures how much of a song comprises of lyrics. We can see that until 1950, when one increases the other decreases. After this point though instrumentalness takes the lead and remains on top. 

```{r, echo=FALSE, fig.align="center"}
pivoted_data_by_year %>%
        filter(metric %in% c("instrumentalness", "speechiness")) %>%
        ggplot(aes(x = year, y = values, color = metric)) + geom_line()
```

### Music Popularity Over Time

Our dataset also allows us to see the popularity of music from different periods of time. Each song has a popularity metric, so we can plot the popularity of songs over time to draw inferences from the trends we see. We can see in the graph below that songs before 1950 were not popular at all, having popularity values of close to zero. Then the popularity starts to rise in the 1950s and continues to rise right up until 2000. Then it begins to sharply decline. This means that music made before 2000 is a lot more popular than the music after. This can be explained by the fact that it became much easier to upload music online and gain an audience. It also became easier to stream all kinds of music. Before the 2000s, there were only a few small groups that could make and publish music because of the large barrier to entry made by record labels and publishing companies. But after 2000, this barrier crumbled away and now anyone can upload their music online. This meant that instead of listeners focusing on a small group of bands, they now have a plethora of different genres and artists to choose from. This means that the popularity of any given song after 2000  is less, as there is a smaller concentration of listeners listening to a given song. Songs from before 2000 are also considered to be iconic because of the small number of bands. The Beatles, Queen, Nirvana, these are all iconic bands from that era. But post 2000 because of the rise in smaller artists being able to publish music, people's attention was split and so popularity became distributed instead of being concentrated in a small number of bands. This is why popularity falls after 2000. It's not that music after 2000 is not popular. Rather, the popualarity is distributed across all the songs due to music being easier to access and produce.

```{r, echo=FALSE, fig.align="center"}
data_by_year %>%
  ggplot(aes(x = year, y = popularity)) + geom_line()
```


## Embedded Application

It's also possible to embed an entire Shiny application within an R Markdown document using the `shinyAppDir` function. This example embeds a Shiny application located in another directory:

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)
```

Note the use of the `height` parameter to determine how much vertical space the embedded application should occupy.

You can also use the `shinyApp` function to define an application inline rather then in an external directory.

In all of R code chunks above the `echo = FALSE` attribute is used. This is to prevent the R code within the chunk from rendering in the document alongside the Shiny components.



